// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// Enums
enum Role {
  STUDENT
  MODERATOR
}

enum PostStatus {
  PENDING
  APPROVED
  REJECTED
}

// Models
model GlobalSettings {
  id                   Int      @id @default(1)
  autoApproveEnabled   Boolean  @default(false)
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
}

model Profile {
  id          String     @id @default(uuid())
  userId      String     @unique
  pseudonym   String?    @unique
  reputation  Int        @default(0)
  role        Role       @default(STUDENT)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  
  questions   Question[]
  answers     Answer[]
  votes       Vote[]
  
  @@index([reputation])
  @@index([pseudonym])
}

model Question {
  id          String      @id @default(cuid())
  title       String
  content     String      @db.Text
  views       Int         @default(0)
  status      PostStatus  @default(PENDING)
  authorId    String
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  
  author      Profile     @relation(fields: [authorId], references: [id], onDelete: Cascade)
  tags        Tag[]       @relation("QuestionTags")
  answers     Answer[]
  votes       Vote[]
  
  @@index([status])
  @@index([createdAt])
  @@index([authorId])
}

model Answer {
  id          String      @id @default(cuid())
  content     String      @db.Text
  isAccepted  Boolean     @default(false)
  status      PostStatus  @default(PENDING)
  questionId  String
  authorId    String
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  
  question    Question    @relation(fields: [questionId], references: [id], onDelete: Cascade)
  author      Profile     @relation(fields: [authorId], references: [id], onDelete: Cascade)
  votes       Vote[]
  
  @@index([questionId])
  @@index([authorId])
  @@index([status])
}

model Tag {
  id          String      @id @default(cuid())
  name        String      @unique
  createdAt   DateTime    @default(now())
  
  questions   Question[]  @relation("QuestionTags")
  
  @@index([name])
}

model Vote {
  id          String    @id @default(cuid())
  value       Int       // 1 or -1
  profileId   String
  questionId  String?
  answerId    String?
  createdAt   DateTime  @default(now())
  
  profile     Profile   @relation(fields: [profileId], references: [id], onDelete: Cascade)
  question    Question? @relation(fields: [questionId], references: [id], onDelete: Cascade)
  answer      Answer?   @relation(fields: [answerId], references: [id], onDelete: Cascade)
  
  @@unique([profileId, questionId])
  @@unique([profileId, answerId])
  @@index([questionId])
  @@index([answerId])
}

model AI_FAQ {
  id               String   @id @default(cuid())
  topic            String
  question         String
  answer           String   @db.Text
  sourceQuestionId String?
  generatedAt      DateTime @default(now())
  
  @@index([generatedAt])
}
